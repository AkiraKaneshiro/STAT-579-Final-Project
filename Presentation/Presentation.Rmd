---
title: "Analysis of the Yelp Academic Dataset"
author: "Chelsey Legacy, Lindong Zhou, Evan 'Pete' Walsh"
date: "November 22, 2014"
output: 
  ioslides_presentation:
    logo: yelp2.png
runtime: shiny
---

```{r echo=FALSE}
suppressPackageStartupMessages(require(dplyr))
suppressPackageStartupMessages(require(googleVis))
suppressPackageStartupMessages(require(wordcloud))
suppressPackageStartupMessages(require(tm))
food <- read.csv("/Users/marianwaitwalsh/Github/STAT-579-Final-Project/Data/Restaurants/food.csv")
tips <- read.csv("/Users/marianwaitwalsh/Github/STAT-579-Final-Project/Data/Restaurants/tips.csv")
```

## Intro



## Schedule {.smaller}

Our presentation will procede as follows:

> - Brief description of data
> - Restaurants
>     + The cost of reservations
>     + Loud can be good, but not too loud
>     + It's all about service
>     + Delivery vs. takeout
> - Bars
>     + Food
>     + Stars
>     + Popular features
> - Hotels
> - Shopping

# Data

## Raw data format

Words

## Data cleaning process | Subtitle


# Restaurants

----

```{r, echo=FALSE}
shinyApp(
  ui = fluidPage(responsive = FALSE, 
                 fluidRow(style = "padding-bottom: 20px;",
                  column(2, selectInput("place", label = "Region", 
                            levels(food$state), selected = "WI")),
                  column(4, selectInput("type", label = "Type",
                            choices = levels(food$type), 
                            selected = levels(food$type)[1],
                            multiple = TRUE)),
                  column(2, selectInput("hour", label = "Hour",
                            choices = c("All", "Breakfast",
                                        "Lunch", "Dinner"),
                            selected = "All")),
                  column(2, selectInput("lower", label = "Rating low",
                            choices = as.character(seq(1,5, by=0.5)),
                            selected = "4")),
                  column(2, selectInput("upper", label = "Rating high",
                            choices = as.character(seq(1,5,by=0.5)),
                            selected = "5"))),
                 htmlOutput("map")
                 ),
  
  server = function(input, output) {
    dataInput <- reactive({      
      if (input$hour == "Breakfast") {
        df <- food %>% subset(state == input$place, stars > 4) %>%
          filter(type %in% input$type) %>%
          filter(stars >= as.numeric(input$lower) & 
                   stars <= as.numeric(input$upper))
        df <- df[grep("breakfast': True", df$attributes_good.for),]
      }      
      else if (input$hour == "Lunch") {
        df <- food %>% subset(state == input$place, stars > 4) %>%
          filter(type %in% input$type) %>%
          filter(stars >= as.numeric(input$lower) & 
                   stars <= as.numeric(input$upper))
        df <- df[grep("lunch': True", df$attributes_good.for),]
      }      
      else if (input$hour == "Dinner") {
        df <- food %>% subset(state == input$place, stars > 4) %>%
          filter(type %in% input$type) %>%
          filter(stars >= as.numeric(input$lower) & 
                   stars <= as.numeric(input$upper))
        df <- df[grep("dinner': True", df$attributes_good.for),]
      }      
      else {
      df <- food %>% subset(state == input$place, stars > 4) %>%
        filter(type %in% input$type) %>%
        filter(stars >= as.numeric(input$lower) & 
                 stars <= as.numeric(input$upper))        
      }
    })
    
    output$map <- renderGvis({
      gvis1 <- gvisMap(dataInput(), "location", "tip",
                 options = list(showTip = TRUE, 
                                enableScrollWheel = TRUE,
                                useMapTypeControl = TRUE,
                                mapType = "normal"))
      gvis1
    })
  }
)
```

## The cost of reservations


## Noise pollution


## It's all about service

```{r echo=FALSE}
shinyApp(
  ui = fluidPage(responsive = FALSE,
    fluidRow(
      sidebarPanel(
        selectInput("category", "Category:", 
                    choices = c("More than 4 stars", "Less than 2 stars"), 
                    selected = "More than 4 stars"),
        sliderInput("n", "Sample size:", min = 300, 
                  max = 1000, value = 600, step = 10),
        submitButton("Draw"),
        br(),
        conditionalPanel(
         condition = "input.n > 686 & input.category == 'Less than 2 stars'",
         helpText("Note: there are only 600 tips for restaurants that have less 
                  than 2 stars, so sampling will be done with replacement.")
        )
      ),
      mainPanel(
        h4(textOutput("title")),
        plotOutput("wordcloud", width = 450, height = 400)
      )         
    )),
  
  server = function(input, output) {
    dataInput <- reactive({
      if (input$category == "More than 4 stars") {
        data <- tips %>% subset(stars > 4) %>% select(2)
        data <- sample(data$text, input$n) %>% 
          paste(sep = '', collapse = ' ')
      } else {
        data <- tips %>% subset(stars < 2) %>% select(2)
        if (input$n > 686) {
          data <- sample(data$text, input$n, replace = TRUE) %>% 
            paste(sep = '', collapse = ' ')
        } else {
          data <- sample(data$text, input$n) %>% 
            paste(sep = '', collapse = ' ')          
        }
      }
      data <- gsub("[[:punct:]]", " ", data)
      data <- tolower(data)
      data <- gsub("great", '', data)
      data <- gsub("good", '', data)
      data <- gsub("best", '', data)
      data <- gsub("food", '', data)
      data <- gsub("love", '', data)
      data <- gsub("don", '', data)
      data <- gsub("get" , '', data)
      data <- gsub("try", '', data)
      data <- gsub("place", '', data)
      data <- gsub("amazing", '', data)
      data <- gsub("awesome", '', data)
      data <- gsub("delicious", '', data)
      data
    })
    output$wordcloud <- renderPlot({
      if (input$category == "More than 4 stars") {
        wordcloud(dataInput(), max.words = 100, random.order=F, 
          scale=c(3,0.5),colors=brewer.pal(4,"Dark2"))
      } else {
        wordcloud(dataInput(), max.words = 100, random.order=F, 
          scale=c(3,0.5),colors=brewer.pal(4,"Set1"))
      }
    })
    output$title <- renderText({
      if (input$category == "More than 4 stars") {
        "Wordcloud of user tips for high rated restaurants"
      } else {
        "Wordcloud of user tips for low rated restaurants"
      }
    })
  }
)
```

## It's all about service | Comparison of top and bottom rated restaurants

<table>
<tr><td>Below 2 stars</td>
    <td>Above 4 stars</td>
</tr>
<tr><td><img src="/Users/marianwaitwalsh/Github/STAT-579-Final-Project/Paper/Figures/wordcloud_bottom.jpeg"></td>
    <td><img src="/Users/marianwaitwalsh/Github/STAT-579-Final-Project/Paper/Figures/wordcloud_top.jpeg"></td>
</tr>
</table>
